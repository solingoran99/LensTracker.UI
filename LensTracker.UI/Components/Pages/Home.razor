@page "/"
@inject IJSRuntime JS

<div class="calendar-wrapper">

    <!-- Glowing ambient vertical light behind the wheel -->
    <div class="glow-beam"></div>

    <!-- Vertical scroll calendar -->
    <div class="wheel-container" @onscroll="OnScroll" @ref="WheelRef">

        @foreach (var day in Days)
        {
            <div class="wheel-item @(day == SelectedDay ? "selected" : "")">
                @day
            </div>
        }

        
        <div style="height:180px"></div>

    </div>

    <!-- Floating lens bubble -->
    <div class="start-bubble">
        <button class="start-button" @onclick="StartSession">Start</button>
    </div>

</div>

@code {
    ElementReference WheelRef;

    List<int> Days = Enumerable.Range(1, 31).ToList();
    int SelectedDay = DateTime.Now.Day;

    const int ItemHeight = 60;

    async void OnScroll()
    {
        int scrollTop = await JS.InvokeAsync<int>("getScrollTop", WheelRef);

        // Compute selected day based on center alignment
        int index = (scrollTop + (420 / 2) - 30) / 60;

        if (index >= 0 && index < Days.Count)
        {
            SelectedDay = Days[index];
            await InvokeAsync(StateHasChanged);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            int index = SelectedDay - 1;
            int scrollPosition = (index * ItemHeight);
            await JS.InvokeVoidAsync("scrollToDay", WheelRef, scrollPosition);
        }
    }


    async Task StartSession()
    {
        Console.WriteLine($"Starting session on day {SelectedDay}");
    }
}
