@page "/"
@inject IJSRuntime JS

<div class="calendar-wrapper" @onclick="ResetCalendarPosition">

    <div class="glow-beam"></div>

    <!-- Scroll wheel -->
    <div class="wheel-container" @onscroll="OnScroll" @ref="WheelRef" @onclick:stopPropagation="true">

        <!-- Top padding for centering -->
        <div style="height:180px"></div>

        @foreach (var day in Days)
        {
            <div class="wheel-item @(day == SelectedDay ? "selected" : "")">
                @day
            </div>
        }

        <!-- Bottom padding -->
        <div style="height:180px"></div>
    </div>

    <div class="start-bubble">
        <button class="start-button" @onclick="StartSession">Log Session</button>
    </div>

</div>

@code {
    ElementReference WheelRef;

    List<int> Days = Enumerable.Range(1, 31).ToList();
    int SelectedDay = 1;

    const int ItemHeight = 60;
    const int PadHeight = 180;
    const int ContainerCenter = 210;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                SelectedDay = await JS.InvokeAsync<int>("getClientDate");
            }
            catch
            {
                SelectedDay = DateTime.Now.Day;
            }

            await ResetCalendarPosition();
            StateHasChanged();
        }
    }

    // 🔹 Scrolling should NOT change SelectedDay
    async void OnScroll()
    {
        // Intentionally empty: no selection change on scroll.
    }

    // 🔹 Clicking background resets calendar to today's date
    async Task ResetCalendarPosition()
    {
        int index = SelectedDay - 1;

        int scrollPosition =
            PadHeight +
            (index * ItemHeight) -
            (ContainerCenter - (ItemHeight / 2));

        await JS.InvokeVoidAsync("scrollToDay", WheelRef, scrollPosition);
    }

    void StartSession()
    {
        Console.WriteLine($"Starting session on day {SelectedDay}");
    }
}
